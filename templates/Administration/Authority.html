<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSGP - Authority Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        .detail-section {
            display: none;
        }
        .detail-section.active {
            display: block;
        }
        .stat-card.active {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-color: #4f46e5;
        }
        .modal {
            display: none;
        }
        .modal.active {
            display: flex;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="relative min-h-screen md:flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="bg-white text-gray-800 w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform -translate-x-full transition-transform duration-200 ease-in-out z-30 shadow-lg">
            <div class="px-4">
                <h2 class="text-2xl font-bold text-indigo-600">SSGP Portal</h2>
                <p class="text-sm text-gray-500">Authority Dashboard</p>
            </div>

            <nav class="mt-10">
                <a href="#" id="nav-dashboard" class="nav-link block py-2.5 px-4 rounded transition duration-200 bg-indigo-100 text-indigo-700 font-semibold">
                    <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                </a>
                <a href="#" id="nav-students" class="nav-link block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-200">
                    <i class="fas fa-users mr-2"></i>All Students
                </a>
                 <a href="#" id="nav-students-outside" class="nav-link block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-200">
                    <i class="fas fa-user-clock mr-2"></i>Students Outside
                </a>
                <a href="#" id="nav-late-students" class="nav-link block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-200">
                    <i class="fas fa-exclamation-triangle mr-2"></i>Late Students
                </a>
                <a href="#" id="nav-caretakers" class="nav-link block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-200">
                    <i class="fas fa-user-cog mr-2"></i>Caretakers
                </a>
            </nav>

            <div class="absolute bottom-0 w-full left-0 px-2 pb-5">
                 <a href="{% url 'logout' %}" class="w-full flex items-center justify-center py-2.5 px-4 bg-red-500 text-white rounded hover:bg-red-600 transition duration-200">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </a>
            </div>
        </aside>
        
        <!-- Sidebar Overlay -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden"></div>

        <!-- Main content -->
        <div class="flex-1 flex flex-col">
            <header class="bg-white shadow-md p-4 flex justify-between items-center z-10">
                <button id="hamburger-btn" class="text-gray-500 focus:outline-none focus:text-gray-700">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
                <div class="flex items-center space-x-4">
                    <div class="text-right hidden sm:block">
                        <p class="font-semibold text-gray-800">{{ admin.user.get_full_name }}</p>
                        <p class="text-xs text-gray-500">{{ admin.designation|capfirst }}</p>
                    </div>
                    <img class="w-10 h-10 rounded-full" src="https://placehold.co/100x100/6366f1/ffffff?text={{ admin.user.first_name.0 }}" alt="Admin Profile">
                </div>
            </header>

            <main id="main-content" class="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto">
                <header class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900">Dashboard Overview</h1>
                    <p class="text-gray-500 mt-1">Click on a card to see details.</p>
                </header>

                <!-- Stats Grid -->
                <div id="stats-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div id="card-students" class="stat-card cursor-pointer bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 border-2 border-transparent">
                        <div class="flex items-center justify-between"><div class="p-3 rounded-xl bg-blue-100"><i class="fas fa-users text-2xl text-blue-500"></i></div></div>
                        <div><p class="text-gray-500 text-sm mt-4">Total Students</p><p class="text-3xl font-bold text-gray-800">{{ all_students_count }}</p></div>
                    </div>
                     <div id="card-students-outside" class="stat-card cursor-pointer bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 border-2 border-transparent">
                        <div class="flex items-center justify-between"><div class="p-3 rounded-xl bg-red-100"><i class="fas fa-user-clock text-2xl text-red-500"></i></div></div>
                        <div><p class="text-gray-500 text-sm mt-4">Students Outside</p><p class="text-3xl font-bold text-gray-800">{{ outside_count }}</p></div>
                    </div>
                    <div id="card-late-students" class="stat-card cursor-pointer bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 border-2 border-transparent">
                        <div class="flex items-center justify-between"><div class="p-3 rounded-xl bg-orange-100"><i class="fas fa-exclamation-triangle text-2xl text-orange-500"></i></div></div>
                        <div><p class="text-gray-500 text-sm mt-4">Late Students</p><p class="text-3xl font-bold text-gray-800">{{ late_count }}</p></div>
                    </div>
                    <div id="card-caretakers" class="stat-card cursor-pointer bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 border-2 border-transparent">
                        <div class="flex items-center justify-between"><div class="p-3 rounded-xl bg-yellow-100"><i class="fas fa-user-cog text-2xl text-yellow-500"></i></div></div>
                        <div><p class="text-gray-500 text-sm mt-4">Total Caretakers</p><p class="text-3xl font-bold text-gray-800">{{ caretakers_count }}</p></div>
                    </div>
                </div>

                <!-- Detail Sections -->
                <div id="details-container">
                    <!-- All Students Section -->
                    <section id="students-section" class="detail-section bg-white p-6 rounded-2xl shadow-lg">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">All Students Details</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3">ID</th>
                                        <th class="px-6 py-3">Name</th>
                                        <th class="px-6 py-3">Gender</th>
                                        <th class="px-6 py-3">Year</th>
                                        <th class="px-6 py-3">Branch</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for student in all_students %}
                                    <tr class="bg-white border-b hover:bg-gray-50">
                                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{{ student.user.username }}</td>
                                        <td class="px-6 py-4">{{ student.user.get_full_name }}</td>
                                        <td class="px-6 py-4">{{ student.user.gender }}</td>
                                        <td class="px-6 py-4">{{ student.year }}</td>
                                        <td class="px-6 py-4">{{ student.dept }}</td>
                                    </tr>
                                    {% empty %}
                                    <tr><td colspan="5" class="text-center py-4">No students found.</td></tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Students Outside Section -->
                    <section id="students-outside-section" class="detail-section bg-white p-6 rounded-2xl shadow-lg">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Students Outside Details</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3">ID</th>
                                        <th class="px-6 py-3">Name</th>
                                        <th class="px-6 py-3">Out Time</th>
                                        <th class="px-6 py-3">Expected Return</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for gp in outside_gatepasses %}
                                    <tr class="bg-white border-b hover:bg-gray-50">
                                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{{ gp.student.student_id }}</td>
                                        <td class="px-6 py-4">{{ gp.student.user.get_full_name }}</td>
                                        <td class="px-6 py-4">{{ gp.departure_datetime|date:"d M, Y H:i" }}</td>
                                        <td class="px-6 py-4">{{ gp.return_datetime|date:"d M, Y H:i" }}</td>
                                    </tr>
                                    {% empty %}
                                    <tr><td colspan="4" class="text-center py-4">No students are currently outside.</td></tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </section>
                    
                    <!-- Late Students Section -->
                    <section id="late-students-section" class="detail-section bg-white p-6 rounded-2xl shadow-lg">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Late Students Details</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3">ID</th>
                                        <th class="px-6 py-3">Name</th>
                                        <th class="px-6 py-3">Expected Return</th>
                                        <th class="px-6 py-3">Actual Entry</th>
                                        <th class="px-6 py-3">Late By</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for data in late_students_data %}
                                    <tr class="bg-white border-b hover:bg-gray-50">
                                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{{ data.gatepass.student.student_id }}</td>
                                        <td class="px-6 py-4">{{ data.gatepass.student.user.get_full_name }}</td>
                                        <td class="px-6 py-4">{{ data.gatepass.return_datetime|date:"d M, Y H:i" }}</td>
                                        <td class="px-6 py-4">{{ data.gatepass.entry_time|date:"d M, Y H:i" }}</td>
                                        <td class="px-6 py-4 text-red-600 font-semibold">{{ data.late_by }}</td>
                                    </tr>
                                    {% empty %}
                                    <tr><td colspan="5" class="text-center py-4">No late students found.</td></tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Caretakers Section -->
                    <section id="caretakers-section" class="detail-section bg-white p-6 rounded-2xl shadow-lg">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Caretakers Details</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3">Name</th>
                                        <th class="px-6 py-3">Hostel Assigned</th>
                                        <th class="px-6 py-3">Contact</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for caretaker in all_caretakers %}
                                    <tr class="bg-white border-b hover:bg-gray-50">
                                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{{ caretaker.user.get_full_name }}</td>
                                        <td class="px-6 py-4">{{ caretaker.hostel_assigned }}</td>
                                        <td class="px-6 py-4">{{ caretaker.user.ph_no }}</td>
                                    </tr>
                                    {% empty %}
                                    <tr><td colspan="3" class="text-center py-4">No caretakers found.</td></tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </section>
                </div>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const hamburgerBtn = document.getElementById('hamburger-btn');
            
            const toggleSidebar = () => {
                sidebar.classList.toggle('-translate-x-full');
                sidebarOverlay.classList.toggle('hidden');
            };

            hamburgerBtn.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', toggleSidebar);
            
            document.addEventListener('wheel', () => {
                if (!sidebar.classList.contains('-translate-x-full')) {
                    toggleSidebar();
                }
            }, { passive: true });
            
            const showDetailSection = (sectionId) => {
                document.querySelectorAll('.detail-section').forEach(sec => sec.classList.remove('active'));
                document.querySelectorAll('.stat-card').forEach(card => card.classList.remove('active'));
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('bg-indigo-100', 'text-indigo-700', 'font-semibold');
                    link.classList.add('hover:bg-gray-200');
                });
                
                if (sectionId) {
                    document.getElementById(sectionId).classList.add('active');
                    const cardId = `card-${sectionId.replace('-section', '')}`;
                    if(document.getElementById(cardId)) document.getElementById(cardId).classList.add('active');
                    
                    const navId = `nav-${sectionId.replace('-section', '')}`;
                    if(document.getElementById(navId)) {
                        const navLink = document.getElementById(navId);
                        navLink.classList.add('bg-indigo-100', 'text-indigo-700', 'font-semibold');
                        navLink.classList.remove('hover:bg-gray-200');
                    }
                } else {
                    const dashboardLink = document.getElementById('nav-dashboard');
                    dashboardLink.classList.add('bg-indigo-100', 'text-indigo-700', 'font-semibold');
                    dashboardLink.classList.remove('hover:bg-gray-200');
                }
                 if (!sidebar.classList.contains('-translate-x-full')) {
                    toggleSidebar();
                }
            };

            // Navigation
            document.getElementById('stats-grid').addEventListener('click', (e) => {
                const card = e.target.closest('.stat-card');
                if (card && card.id) {
                    const sectionId = `${card.id.replace('card-','')}-section`;
                    showDetailSection(sectionId);
                }
            });

            document.getElementById('nav-dashboard').addEventListener('click', (e) => { e.preventDefault(); showDetailSection(null); });
            document.getElementById('nav-students').addEventListener('click', (e) => { e.preventDefault(); showDetailSection('students-section'); });
            document.getElementById('nav-students-outside').addEventListener('click', (e) => { e.preventDefault(); showDetailSection('students-outside-section'); });
            document.getElementById('nav-late-students').addEventListener('click', (e) => { e.preventDefault(); showDetailSection('late-students-section'); });
            document.getElementById('nav-caretakers').addEventListener('click', (e) => { e.preventDefault(); showDetailSection('caretakers-section'); });
        });
    </script>
</body>
</html>
